/**
 * @author:   tony
 * @version:  v1.0.0
 * @license:  MIT
 * @name:     tPage分页插件
 */
var tPage;(function(a){tPage=function(c,b){this.options=a.extend({},this.defaults,b);this.options.pageCount=Math.ceil(this.options.pageLimit/this.options.pageOne);this.$pageBox=c;this.init(this.options);return this};tPage.prototype.defaults={pageId:null,pageOne:10,pageLimit:1,pageCount:1,pageCur:1,pageJson:{},pageJson_textName:"text",pageJson_hrefName:"href",pageEvent:function(){},pageEventInit:false,pageAttr:"pageto"};tPage.prototype.init=function(b){this.$prev=a('<a href="javascript:void(0);" class="page-prev"><span>上一页</span></a>').attr(b.pageAttr,((b.pageCur-1)<=0)?1:(b.pageCur-1));this.$content=a("<span>");this.$next=a('<a class="page-next" href="javascript:void(0);"><span>下一页</span></a>').attr(b.pageAttr,((b.pageCur+1)<=b.pageCount)?(b.pageCur+1):b.pageCount);this.$skip=a('<span class="page-skip"></span>');this.$skipWords=a("<em>").text(b.pageCount);this.$skipInput=a('<input type="text" title="输入页码" value="" />');this.$skipSubmit=a('<button title="指定页码" type="submit">确定</button>');this.$skip.append("共",this.$skipWords,"页到第",this.$skipInput,"页",this.$skipSubmit);this.$pageBox.append(this.$prev,this.$content,this.$next,this.$skip);this.go(b.pageCur);this.options.pageEventInit=true;var c=this;this.$pageBox.find("a").die("click").live("click",function(){var d=parseInt(a(this).attr(b.pageAttr));if(!d){return}c.go(d)});this.$skipSubmit.unbind("click").bind("click",function(){var d=parseInt(c.$skipInput[0].value);if(d==parseInt(c.options.pageCur)){return}c.go(d)});this.$skipInput.unbind(".page").bind("propertychange.page input.page keydown.page",function(){this.value=this.value.replace(/[^\d.]/g,"")})};tPage.prototype.go=function(b){var c=parseInt(this.options.pageCount);b=parseInt(b);b=(b<=0)?1:b;b=(c<=b)?c:b;if(b){this.options.pageCur=b}this.setContent(this.options);if(a.isFunction(this.options.pageEvent)&&this.options.pageEventInit){this.options.pageEvent.call(this)}};tPage.prototype.reset=function(b){this.$prev.removeClass("prev-no").attr(b.pageAttr,null);this.$next.removeClass("next-no").attr(b.pageAttr,null);this.$content.html("")};tPage.prototype.setContentArray=function(f,g,h){var d=[];for(var b=f;b<=g;b++){if(b==h){d.push('<strong class="page-cur">'+b+"</strong>")}else{d.push('<a href="javascript:void(0);" '+this.options.pageAttr+'="'+b+'">'+b+"</a>")}}return d};tPage.prototype.setContent=function(c){this.reset(c);var g=parseInt(c.pageCur),f=parseInt(c.pageCount),h=g-2,b=g+2,e=[];b=((f-b)<=0)?f:((b-5)<0)?5:b;h=(h<=0)?1:(b-h<5)?(b-4):h;if(g==1){this.$prev.addClass("prev-no")}else{this.$prev.attr(c.pageAttr,g-1)}if(f<10){e=this.setContentArray(1,f,g)}else{if(g-6<0){e=a.merge(e,this.setContentArray(1,b,g))}else{e.push('<a href="javascript:void(0);" '+c.pageAttr+'="1">1</a>');e.push('<span class="page-break">...</span>');e=a.merge(e,this.setContentArray(h,b,g))}if(g+4-f<0){e.push('<span class="page-break">...</span>');e.push('<a href="javascript:void(0);" '+c.pageAttr+'="'+f+'">'+f+"</a>")}else{e=a.merge(e,this.setContentArray(b+1,f,g))}}var d=e.join("\n");this.$content.html(d);if(g==f){this.$next.addClass("next-no");this.$skipInput[0].value=g}else{this.$next.attr(c.pageAttr,(g+1));this.$skipInput[0].value=(g+1)}};a.fn.tPage=function(b){new tPage(a(this),b)}})(jQuery);